#!/usr/bin/env ruby
# frozen_string_literal: true
#
# rubyc bin/ylem --keep-tmpdir -r . -o ylem
require 'pathname'

$PROGRAM_NAME = 'ylem'

# runnning in a development context ----------------------------------

# rubocop:disable Style/YodaCondition
if 'development' == ENV['PROJECT_MODE']
  if Pathname.new(__dir__).join('..', 'Gemfile').file?
    require 'rubygems'
    require 'bundler'

    Bundler.setup(:default)
  else
    ENV['PROJECT_MODE'] = nil
  end
end
# rubocop:enable Style/YodaCondition

# require lib requirements -------------------------------------------

[nil, :cli].each do |r|
  req = r ? "#{$PROGRAM_NAME}/#{r}" : $PROGRAM_NAME

  begin
    require Pathname.new(__dir__).join('..', 'lib', '%s' % req)
  rescue LoadError
    begin
      require req
    rescue LoadError
      require 'rubygems'
      require req
    end
  end
end

# set process name ---------------------------------------------------

require 'sys/proc'

Sys::Proc.progname = nil

# process command line options and run -------------------------------

exit Ylem::Cli.run.to_i
