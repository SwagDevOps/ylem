#!/usr/bin/env ruby
# frozen_string_literal: true

require 'pathname'

$PROGRAM_NAME = Pathname.new(__FILE__).basename.to_s

# runnning in a development context ----------------------------------
if 'development' == ENV['PROJECT_MODE']
  require 'rubygems'
  require 'bundler'

  Bundler.setup(:default)
end

# set process name ---------------------------------------------------
require 'sys/proc'

Sys::Proc.progname = $PROGRAM_NAME

# require lib requirements -------------------------------------------
[nil, :cli].each do |r|
  req = r ? "#{$PROGRAM_NAME}/#{r}" : $PROGRAM_NAME

  begin
    require Pathname.new(__dir__).join('..', 'lib', '%s' % req)
  rescue LoadError
    begin
      require req
    rescue LoadError
      require 'rubygems'
      require req
    end
  end
end

# process command line options and run -------------------------------
exit Ylem::Cli.run.to_i
